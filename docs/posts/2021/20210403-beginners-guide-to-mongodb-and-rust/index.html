<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="color-scheme" content="light dark">

    

    <meta name="author" content="Tahar Meijs">
    <meta name="description" content="Beginner’s guide to MongoDB and Rust    These days non-relational databases are everywhere. Almost all popular languages have drivers for these databases. Personally, I’m a fan of MongoDB as it’s fairly easy to work with, performs well, and suits all my needs and then some!
In this post, we’ll take a look at the Rust driver for MongoDB. By the end of this article you’ll be able to operate on your own collections using Rust.">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Beginner&#39;s guide to MongoDB and Rust"/>
<meta name="twitter:description" content="Beginner’s guide to MongoDB and Rust    These days non-relational databases are everywhere. Almost all popular languages have drivers for these databases. Personally, I’m a fan of MongoDB as it’s fairly easy to work with, performs well, and suits all my needs and then some!
In this post, we’ll take a look at the Rust driver for MongoDB. By the end of this article you’ll be able to operate on your own collections using Rust."/>

    <meta property="og:title" content="Beginner&#39;s guide to MongoDB and Rust" />
<meta property="og:description" content="Beginner’s guide to MongoDB and Rust    These days non-relational databases are everywhere. Almost all popular languages have drivers for these databases. Personally, I’m a fan of MongoDB as it’s fairly easy to work with, performs well, and suits all my needs and then some!
In this post, we’ll take a look at the Rust driver for MongoDB. By the end of this article you’ll be able to operate on your own collections using Rust." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://tahar.dev/posts/2021/20210403-beginners-guide-to-mongodb-and-rust/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-04-03T00:00:00+00:00" />



    <title>
  Beginner&#39;s guide to MongoDB and Rust · Tahar&#39;s Blog
</title>

    
      <link rel="canonical" href="http://tahar.dev/posts/2021/20210403-beginners-guide-to-mongodb-and-rust/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css" integrity="sha256-2f3b/&#43;byfmmYXcX&#43;BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.ccbbada2e264e4fdbf9b2181cccc2cdb289a63dc9520a1e96ac2b9a45778df29.css" integrity="sha256-zLutouJk5P2/myGBzMws2yiaY9yVIKHpasK5pFd43yk=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    <meta name="generator" content="Hugo 0.89.4" />
  </head>

  
  
    
  
  <body class="preload-transitions colorscheme-auto">
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Tahar&#39;s Blog
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://tahar.dev/posts/2021/20210403-beginners-guide-to-mongodb-and-rust/">
              Beginner&#39;s guide to MongoDB and Rust
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2021-04-03T00:00:00Z'>
                April 3, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              7-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa fa-folder" aria-hidden="true"></i>
    <a href="/categories/rust/">rust</a></div>

          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/rust/">rust</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/backend/">backend</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/server/">server</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/database/">database</a>
    </span>
      <span class="separator">•</span>
    <span class="tag">
      <a href="/tags/mongodb/">mongodb</a>
    </span></div>

        </div>
      </header>

      <div>
        
          <img src='/images/2021/beginners-guide-to-mongodb-and-rust/cover.png' alt="Featured image"/>
        
        <h1 id="beginners-guide-to-mongodb-and-rust">
  Beginner’s guide to MongoDB and Rust
  <a class="heading-link" href="#beginners-guide-to-mongodb-and-rust">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>These days non-relational databases are everywhere. Almost all popular languages have drivers for these databases. Personally,
I’m a fan of MongoDB as it’s fairly easy to work with, performs well, and suits all my needs and <em>then some</em>!</p>
<p>In this post, we’ll take a look at the <a href="https://docs.mongodb.com/drivers/rust/">Rust driver for MongoDB</a>. By the end of this
article you’ll be able to operate on your own collections using Rust.</p>
<p>Please bear in mind that this article will stick to relatively basic operations. The goal of this article is to get you up to
speed with the MongoDB driver, that’s all.</p>
<p>We will learn how to:</p>
<ul>
<li>Connect to a MongoDB instance using a connection string.</li>
<li>Insert data into a collection.</li>
<li>Read data from a collection.</li>
<li>Update an entry in a collection.</li>
<li>Delete data from a collection.</li>
</ul>
<h2 id="asynchronous-or-not">
  Asynchronous or not?
  <a class="heading-link" href="#asynchronous-or-not">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>One of the very first decisions you have to make is whether you’d like to query the database synchronously or asynchronously.
The driver supports both synchronous and asynchronous operations, so it’s up to you to choose the one that suits your needs
best.</p>
<p>The driver supports both <a href="https://tokio.rs/">Tokio</a> and <a href="https://async.rs/">async-std</a> runtimes for asynchronous processing,
but Tokio is used by default. Since I don’t really care too much about which asynchronous runtime we’ll use, I’ll stick with
the default: Tokio.</p>
<p>Be sure to check out the <a href="https://github.com/mongodb/mongo-rust-driver#example-usage">documentation</a> if you’d like to change
the default behavior of the driver. It also describes how to make use of the synchronous methods (should you want to use those
instead).</p>
<h2 id="dependencies">
  Dependencies
  <a class="heading-link" href="#dependencies">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Getting started with the MongoDB driver for Rust is easy, just add it as a dependency to your <code>Cargo.toml</code> file and you’re good
to go!</p>
<p>I’ve also added Tokio as a dependency, but that’s just because I use the asynchronous version of the MongoDB driver.</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/cargo_toml.png" alt="Cargo.toml (created with Carbon)"></p>
<p><em>Cargo.toml (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<h2 id="connecting-to-mongodb">
  Connecting to MongoDB
  <a class="heading-link" href="#connecting-to-mongodb">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>We’ll use a connection string to connect to a MongoDB instance.</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/connection_mongodb.png" alt="Connecting to a MongoDB instance (created with Carbon)"></p>
<p><em>Connecting to a MongoDB instance (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<p>Once a connection has been established, we can use the client instance to get access its databases and, in turn, their
collections and documents.</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/access_db_and_collection.png" alt="Accessing databases and their collections (created with Carbon)"></p>
<p><em>Accessing databases and their collections (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<h2 id="inserting-data-into-a-collection">
  Inserting data into a collection
  <a class="heading-link" href="#inserting-data-into-a-collection">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Let’s start out by investigating how we can create documents.</p>
<p>We’ll need to find a way to serialize data before we can store it in MongoDB. Data in MongoDB is stored in a JSON-like format.
Since JSON isn’t a compact, nor efficient format, MongoDB uses <a href="https://en.wikipedia.org/wiki/BSON">BSON</a>(binary JSON) instead.</p>
<p>To help us generate BSON, the MongoDB driver comes with a special macro to generate BSON. Alternatively,
<a href="https://crates.io/crates/serde">serde.rs</a> can be used to easily serialize structures into BSON as well.</p>
<p>We’ll cover both approaches below.</p>
<h3 id="bson-using-doc">
  BSON using “doc!”
  <a class="heading-link" href="#bson-using-doc">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>In the BSON module, we find the <code>doc!</code> macro. This macro can be used to quickly create BSON data.</p>
<p>To make use of this macro, add the following
“<a href="https://doc.rust-lang.org/reference/items/use-declarations.html">use declaration</a>” to the top of your Rust source file:
<code>use mongodb::bson::doc</code>.</p>
<p>We can then use the macro to generate a new BSON document:</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/bson_doc_macro.png" alt="BSON generated using the doc! macro (created with Carbon)"></p>
<p><em>BSON generated using the doc! macro (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<h3 id="bson-from-a-structure">
  BSON from a structure
  <a class="heading-link" href="#bson-from-a-structure">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Generating BSON from a structure is slightly more complex. It’s not terribly difficult, but we will need to update our
<code>Cargo.toml</code> file to include the Serde crate:</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/updated_cargo_toml.png" alt="Updated Cargo.toml file (created with Carbon)"></p>
<p><em>Updated Cargo.toml file (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<p>We need Serde so we can get make use of its Serialize and Deserialize attributes: <code>use serde::{Serialize, Deserialize};</code></p>
<p>Now that we have Serde as a dependency, we can create a new data structure that will represent our document. The big advantage
of representing structures instead of the macro mentioned previously is that you can now easily modify the document’s
structure.</p>
<p>The new structure will have the same fields as the BSON generated by the macro. This allows for easy comparison between the two
approaches.</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/doc_as_structure.png" alt="Document as a structure (created with Carbon)"></p>
<p><em>Document as a structure (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<p>This structure has three annotations:</p>
<ul>
<li><strong>Debug</strong>: allow for easy printing of its contents to the console.</li>
<li><strong>Serialize</strong>: attribute provided by Serde to serialize data</li>
<li><strong>Deserialize</strong>: attribute provided by Serde to deserialize data</li>
</ul>
<p>Creating an instance of this structure is straightforward and will not be covered. It works exactly the same as any other
structure in Rust.</p>
<h3 id="inserting-data">
  Inserting data
  <a class="heading-link" href="#inserting-data">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>We took a bit of a detour there with all the BSON talk… But we’re finally ready to start inserting data into our collections!</p>
<p>Inserting BSON data generated with the macro is easy enough:</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/insert_structure.png" alt="Inserting a structure into a collection using the doc! macro (created with Carbon)"></p>
<p><em>Inserting a structure into a collection using the doc! macro (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<p>If you’re using structures, however, you’ll run into an error that tells you that a structure of type <code>mongodb::bson::Document</code>
is expected.</p>
<p>To fix this, import the <code>mongodb::bson::to_document</code> function. This method allows us to serialize our structure into BSON as
shown in the snippet below:</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/insert_structure_to_document.png" alt="Inserting a structure into a collection (created with Carbon)"></p>
<p><em>Inserting a structure into a collection (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<h2 id="reading-data-from-a-collection">
  Reading data from a collection
  <a class="heading-link" href="#reading-data-from-a-collection">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>One of the common operations you’ll most likely perform on your collections is reading data from them. The BSON currently in
our database is fairly boring, so we’ll clear out the existing collection to prepare for the next chapter…</p>
<p>Also, let’s create a new structure called <code>Person</code> and give it some properties:</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/person_struct.png" alt="Person struct (created with Carbon)"></p>
<p><em>Person struct (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<p>We’ll go ahead and insert a couple of these objects into the collection. Check out the previous chapter to learn how you can
insert the data.</p>
<p>Bonus points: read the documentation and use <code>insert_many</code> to insert a bunch of documents at once!</p>
<p>If all went well, you should end up with a database that looks somewhat like so:</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/db_various_docs.png" alt="Database with various documents"></p>
<p><em>Database with various documents</em></p>
<p>Reading data from a collection is relatively easy. You have multiple functions at your disposal to do so. I’d highly recommend
looking at the documentation to see what the other functions do, but we’re just going to have a look at the <code>find_one()</code>
function.</p>
<p>This function does exactly what you’d expect it to do: it’ll find a single entry in the database that matches your filter.</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/read_single_document.png" alt="Reading a single document from a collection (created with Carbon)"></p>
<p><em>Reading a single document from a collection (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<p>As you may have noticed, we use a BSON document as a filter. You could, of course, use a structure here instead. Just serialize
it into a BSON document and you’re good to go.</p>
<p>Personally, I find the macro easier to read and use, but that’s just personal preference.</p>
<h2 id="updating-data-in-a-collection">
  Updating data in a collection
  <a class="heading-link" href="#updating-data-in-a-collection">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Updating data in collections is relatively simple. The difficult part is constructing a good query. Once you have a query,
you’ll just have to make a call to <code>update_one</code> or <code>replace_one</code> in order to submit your updated data.</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/update_existing_doc.png" alt="Updating a field of an existing document in a collection (created with Carbon)"></p>
<p><em>Updating a field of an existing document in a collection (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<p>You’ll have to make the decision whether it’s better to update a couple of fields, or replace the entire document with a new
one. Both functions take in almost identical arguments, so it should be easy to convert the code above into a replace operation
instead.</p>
<h2 id="deleting-data-from-a-collection">
  Deleting data from a collection
  <a class="heading-link" href="#deleting-data-from-a-collection">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Removing your data is as easy reading it. In fact, the code is pretty much identical, except for the function’s name!</p>
<p><img src="/images/2021/beginners-guide-to-mongodb-and-rust/delete_existing_doc.png" alt="Delete an existing document from a collection (created with Carbon)"></p>
<p><em>Delete an existing document from a collection (created with <a href="https://carbon.now.sh/">Carbon</a>)</em></p>
<h2 id="closing-words">
  Closing words
  <a class="heading-link" href="#closing-words">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>I hope this short introduction to the MongoDB Rust driver has helped you to get up to speed with MongoDB and Rust. Obviously
there’s a ton of stuff we haven’t covered yet in this article, but you should now have enough knowledge to figure it out by
yourself.</p>
<p>For instance, we’ve only covered the simplest database functions. The driver comes with a bunch of other functions such as
<code>find</code>, <code>find_one_and_update</code>, <code>find_one_and_delete</code>, <code>insert_many</code>, <code>count_documents</code>, and many others!</p>
<p>I’d highly recommend you to check out the crate’s <a href="https://docs.rs/mongodb/1.2.0/mongodb/index.html">documentation</a> to learn
more about the Rust driver.</p>
<p>Thank you so much for taking the time to read this article.</p>
<p>Have a good one.</p>
<p>Cheers!</p>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    ©
    
    2021
     Tahar Meijs 
    ·
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

    </main>

    
      
      <script src="/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js" integrity="sha256-A7F3afT5GuNWZ&#43;HyocqMFvUFYlds&#43;Q/zKzF5kmkU2qU="></script>
    

    

    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z52Z9NGP1T"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-Z52Z9NGP1T', { 'anonymize_ip': false });
}
</script>


    

    

    

    

    

    
  </body>

</html>
